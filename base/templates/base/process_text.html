<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Process Text</title>
  <style>
    body {
      font-family: Inter, system-ui;
      background: #0B0F1A;
      color: #E7ECF3;
      max-width: 900px;
      margin: 50px auto;
      padding: 30px;
    }
    select, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.06);
      color: #E7ECF3;
      font-size: 15px;
    }
    button {
      background: #FF2F5A;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    .result-card {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
    }
    img.logo {
      height: 60px;
      margin-bottom: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Process Job Text</h1>
  <p>Paste a job description or posting below, then process it into structured data.</p>

  <label>Industry</label>
  <select id="industry">
    {% for key, label in industries %}
      <option value="{{ key }}">{{ label }}</option>
    {% endfor %}
  </select>

  <label>Job Type</label>
  <select id="job_type">
    {% for key, label in job_types %}
      <option value="{{ key }}">{{ label }}</option>
    {% endfor %}
  </select>

  <label>Country</label>
  <select id="country">
    {% for key, label in countries %}
      <option value="{{ key }}">{{ label }}</option>
    {% endfor %}
  </select>

  <label>Paste Text</label>
  <textarea id="text" rows="8" placeholder="Paste job text here..."></textarea>

  <button id="processBtn">Process Text</button>

  <div id="result" class="result-card" style="display:none;"></div>

  <script>
    document.getElementById("processBtn").addEventListener("click", async () => {
      const text = document.getElementById("text").value.trim();
      const industry = document.getElementById("industry").value;
      const job_type = document.getElementById("job_type").value;
      const country = document.getElementById("country").value;

      if (!text) {
        alert("Please enter text first.");
        return;
      }

      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML = "⏳ Processing...";

      try {
        const res = await fetch("/process_text/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, industry, job_type, country }),
        });

        const data = await res.json();
        if (!data.success) throw new Error(data.error || "Processing failed.");

        document.getElementById("result").innerHTML = `
          <img src="${data.logo_url}" class="logo" alt="Logo" onerror="this.style.display='none'">
          <h2>${data.company_name}</h2>
          <p><strong>Description:</strong> ${data.company_description}</p>
          <p><strong>Location:</strong> ${data.location}</p>
          <p><strong>Industry:</strong> ${data.industry}</p>
          <p><strong>Job Type:</strong> ${data.job_type}</p>
          <p><strong>Country:</strong> ${data.country}</p>
        `;
      } catch (err) {
        document.getElementById("result").innerHTML = `<p style="color:#ff2f5a;">❌ Error: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
