<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Process Job Text</title>
  <style>
    body { font-family: Inter, sans-serif; background:#0b0f1a; color:#fff; padding:40px; }
    .card { background:#121826; border-radius:14px; padding:24px; max-width:800px; margin:auto; }
    textarea { width:100%; height:300px; padding:12px; border-radius:10px; border:none; font-size:15px; margin-top:10px; }
    button { background:#FF2F5A; border:none; padding:12px 20px; border-radius:10px; color:#fff; font-weight:700; cursor:pointer; margin-top:10px; }
    .result { margin-top:20px; background:#1a2133; border-radius:10px; padding:16px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Process Job Text</h1>
    <p>Paste a job description or posting below, then process it into structured data.</p>

    <p><b>Industry</b>: Marketing & Communications</p>
    <p><b>Job Type</b>: Internship</p>
    <p><b>Country</b>: üá©üá∞ Denmark</p>

    <textarea id="jobText" placeholder="Paste job description here..."></textarea>
    <button id="processBtn">Process Text</button>

    <div id="result" class="result"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const processBtn = document.getElementById("processBtn");
      const resultBox = document.getElementById("result");
      const jobText = document.getElementById("jobText");
    
      processBtn.addEventListener("click", async (e) => {
        e.preventDefault(); // üö´ Prevent default form or button behavior
        const text = jobText.value.trim();
        if (!text) return alert("Please paste job text first.");
    
        resultBox.innerHTML = "‚è≥ Processing...";
    
        const payload = {
          text,
          industry: "marketing",
          job_type: "internship",
          country: "DK"
        };
    
        try {
          // ‚úÖ Always use POST and ensure JSON headers are sent
          const res = await fetch("/process-text/", {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
          });
    
          // üëÄ If backend fails, Django might send HTML ‚Äî handle that
          const contentType = res.headers.get("content-type");
          if (!contentType || !contentType.includes("application/json")) {
            const html = await res.text();
            console.error("Server returned HTML instead of JSON:", html.slice(0, 200));
            resultBox.innerHTML = "‚ùå Server returned HTML instead of JSON (check console).";
            return;
          }
    
          const data = await res.json();
          if (!data.success) {
            resultBox.innerHTML = `‚ùå Error: ${data.error || "Failed"}`;
            return;
          }
    
          resultBox.innerHTML = `
            ‚úÖ <b>${data.company_name}</b><br>
            <b>Description:</b> ${data.company_description}<br>
            <b>Location:</b> ${data.location}<br>
            <b>Logo:</b> <img src="${data.logo_url}" width="60" style="vertical-align:middle;border-radius:6px;"><br>
            <b>Industry:</b> ${data.industry}<br>
            <b>Job Type:</b> ${data.job_type}<br>
            <b>Country:</b> ${data.country}<br>
            <p style="color:#4CAF50;">‚úÖ Added to database successfully.</p>
          `;
        } catch (err) {
          console.error("Fetch failed:", err);
          resultBox.innerHTML = "‚ùå Failed to process request (see console).";
        }
      });
    });
    </script>
    
</body>
</html>
