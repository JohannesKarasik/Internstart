{% extends 'main.html' %}
{% load static %}

{% block content %}
<main class="pricing-page">
  <!-- Hero -->
  <header class="hero">

    <h1>Choose your plan</h1>
    <p class="subtitle">Swipe through jobs and instantly send AI-tailored applications to employers.</p>

    <!-- Billing Toggle -->

  </header>

  <!-- Pricing Grid -->
  <section class="pricing-grid" aria-label="Plans">
    <!-- Starter -->
    <article class="card" data-plan="starter">
      <div class="card-head">
        <h2 class="plan-name">Starter</h2>
        <p class="plan-tag">For exploring</p>
        <p class="price">
          <span class="price-amount" data-monthly="DKK 89" data-yearly="€9">€12</span>
          <span class="price-term">/mo</span>
        </p>
      </div>
      <ul class="features">
        <li><strong>50 AI-tailored applications / month</strong></li>
        <li>Unlimited skips</li>
        <li>Customer support</li>
      </ul>
      <p class="feature-note">Applications are sent directly to the employer when you swipe.</p>
      
      <a href="#" class="cta" data-tier="starter">Get Starter</a>
    </article>

    <!-- Pro (featured) -->
    <article class="card is-featured" data-plan="pro" aria-label="Most popular">
      <div class="card-badge" aria-hidden="true">Most Popular</div>
      <div class="card-head">
        <h2 class="plan-name">Pro</h2>
        <p class="plan-tag">For serious seekers</p>
        <p class="price">
          <span class="price-amount" data-monthly="DKK 199" data-yearly="€19">€24</span>
          <span class="price-term">/mo</span>
        </p>
      </div>
      <ul class="features">
        <li><strong>200 AI-tailored applications / month</strong></li>
        <li>Unlimited skips</li>
        <li>Customer support</li>
      </ul>
      <p class="feature-note">Applications are sent directly to the employer when you swipe.</p>
      
      <a href="#" class="cta cta-primary checkout-btn" style="      background: linear-gradient(135deg, #FF2F5A, #ffffff);
      color: var(--accent-ink);
      border:1px solid rgba(255,47,90,0.40);
      box-shadow: 0 10px 24px rgba(255,47,90,0.20);" data-tier="pro">Start Pro</a>
    </article>

    <!-- Elite -->
    <article class="card" data-plan="elite">
      <div class="card-head">
        <h2 class="plan-name">Elite</h2>
        <p class="plan-tag">For serious career builders</p>
        <p class="price">
          <span class="price-amount" data-monthly="DKK 399" data-yearly="€39">€49</span>
          <span class="price-term">/mo</span>
        </p>
      </div>
      <ul class="features">
        <li><strong>400 AI-tailored applications / month</strong></li>
        <li>Unlimited skips</li>
        <li>Customer support</li>
      </ul>
      <p class="feature-note">Applications are sent directly to the employer when you swipe.</p>
      
      <a href="#" class="cta checkout-btn" data-tier="elite">Go Elite</a>
    </article>
  </section>

  <!-- Trust + Secondary actions -->
  <section class="foot-notes">
    <p class="guarantee">14-day money-back guarantee • Cancel anytime</p>
    <div class="secondary-actions">
      <a class="link-muted" href="{% url 'update-user' %}">Manage billing</a>
      <span aria-hidden="true">•</span>
      <a class="link-muted" href="{% url 'logout' %}">Log out</a>
    </div>
  </section>
</main>

<style>
    /* ---------- Theme: Black ↔ White with #FF2F5A ---------- */
    :root{
      --bg: #ffffff;                 /* page background */
      --bg-soft: #ffffff;            /* surfaces behind controls */
      --card: #ffffff;               /* card fill */
      --card-stroke: rgba(17,17,17,0.08);
      --txt: #0a0a0a;                /* primary text (near black) */
      --txt-dim: #4b5563;            /* slate-600 */
      --accent: #FF2F5A;             /* brand */
      --accent-ink: #0a0a0a;         /* legible on accent */
      --muted: #f3f4f6;              /* light gray bg */
      --ring: 2px solid #FF2F5A;     /* focus ring */
      --radius: 16px;
      --shadow: 0 8px 30px rgba(0,0,0,0.08);
    }
    
    /* Prefer dark scheme? Keep it mostly white with stronger text */
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #f7f7f8;
        --bg-soft: #ffffff;
        --card: #ffffff;
        --card-stroke: rgba(0,0,0,0.12);
        --txt: #0a0a0a;
        --txt-dim: #374151;
        --shadow: 0 10px 34px rgba(0,0,0,0.12);
      }
    }
    
    /* ---------- Layout ---------- */
    .pricing-page{
      min-height:100vh;
      background:
        radial-gradient(1100px 560px at 80% -10%, rgba(255,47,90,0.10), transparent 60%),
        radial-gradient(900px 480px at -10% 20%, rgba(0,0,0,0.04), transparent 60%),
        var(--bg);
      color:var(--txt);
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:28px;
      padding:48px 24px 40px;
    }
    
    .hero{ text-align:center; max-width:900px; margin:0 auto; }
    .hero h1{ font-size:clamp(28px,3vw,40px); letter-spacing:-0.02em; margin:0 0 8px; }
    .subtitle{ color:var(--txt-dim); font-size:clamp(14px,1.6vw,18px); margin:0 auto 18px; }
    
    /* ---------- Toggle ---------- */
    .billing-toggle{
      display:inline-flex; align-items:center; gap:6px;
      background:var(--bg-soft);
      border:1px solid var(--card-stroke);
      padding:6px; border-radius:999px;
    }
    .toggle-btn{
      appearance:none; border:0; background:transparent;
      color:var(--txt-dim); padding:10px 16px; border-radius:999px;
      font-weight:600; cursor:pointer;
      transition: color .2s ease, background .2s ease, transform .06s ease, border-color .2s ease;
    }
    .toggle-btn:focus-visible{ outline:var(--ring); outline-offset:2px; }
    .toggle-btn.is-active{
      background:linear-gradient(135deg, rgba(255,47,90,0.16), rgba(255,255,255,0.85));
      color:var(--txt);
      border:1px solid rgba(255,47,90,0.35);
      box-shadow: 0 6px 16px rgba(255,47,90,0.12);
    }
    .toggle-btn:active{ transform:translateY(1px); }
    .save-badge{ font-size:12px; font-weight:700; color:var(--accent); margin-left:6px; }
    
    /* ---------- Grid ---------- */
    .pricing-grid{
      display:grid; grid-template-columns:repeat(3, minmax(0,1fr));
      gap:18px; max-width:1100px; margin:0 auto;
    }
    
    /* ---------- Cards ---------- */
    .card{
      position:relative;
      background:var(--card);
      border:1px solid var(--card-stroke);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      display:flex; flex-direction:column; justify-content:space-between;
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    .card:hover{
      transform:translateY(-4px);
      border-color: rgba(0,0,0,0.18);
      box-shadow: 0 18px 40px rgba(0,0,0,0.10);
      background: linear-gradient(180deg, #ffffff, #ffffff);
    }
    
    /* Featured plan pops with accent edge + subtle background tint */
    .card.is-featured{
      border:1.5px solid rgba(255,47,90,0.65);
      box-shadow: 0 22px 60px rgba(255,47,90,0.16);
      background:
        linear-gradient(180deg, rgba(255,47,90,0.05), transparent 60%),
        #ffffff;
    }
    
    .card-badge{
      position:absolute; top:-12px; left:18px;
      background: linear-gradient(135deg, #FF2F5A, #ffffff);
      color: var(--accent-ink);
      font-weight:800; font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,47,90,0.35);
      box-shadow: 0 10px 24px rgba(255,47,90,0.20);
    }
    
    .card-head{ margin-bottom:12px; }
    .plan-name{ margin:0; font-size:22px; letter-spacing:-0.01em; }
    .plan-tag{
      margin:4px 0 10px; color:var(--accent);
      font-weight:700; font-size:12px; letter-spacing:0.06em; text-transform:uppercase;
    }
    
    .price{ margin:0 0 8px; font-weight:800; }
    .price-amount{ font-size:34px; }
    .price-term{ color:var(--txt-dim); margin-left:4px; font-weight:600; }
    
    /* ---------- Features ---------- */
    .features{
      list-style:none; margin:12px 0 20px; padding:0;
      color:var(--txt-dim); display:grid; gap:10px;
    }
    .features li{
      display:grid; grid-template-columns:18px 1fr; gap:10px; align-items:baseline;
    }
    .features li::before{
      content:''; width:14px; height:14px; border-radius:4px;
      background: linear-gradient(135deg, #0a0a0a, #FF2F5A);
      display:inline-block; margin-top:3px;
      box-shadow: 0 6px 14px rgba(255,47,90,0.18);
    }
    
    /* ---------- CTAs ---------- */
    .cta{
      display:inline-flex; justify-content:center; align-items:center; gap:8px;
      text-decoration:none; border-radius:12px; padding:12px 16px;
      border:1px solid var(--card-stroke); color:var(--txt); font-weight:700;
      transition: background .2s ease, transform .06s ease, border .2s ease, box-shadow .2s ease, color .2s ease;
    }
    .cta:hover{
      background: rgba(0,0,0,0.04);
      border-color: rgba(0,0,0,0.18);
      box-shadow: 0 6px 16px rgba(0,0,0,0.10);
    }
    .cta:active{ transform:translateY(1px); }
    .cta:focus-visible{ outline:var(--ring); outline-offset:3px; }
    
    .cta-primary{
      background: linear-gradient(135deg, #FF2F5A, #ffffff);
      color: var(--accent-ink);
      border:1px solid rgba(255,47,90,0.40);
      box-shadow: 0 10px 24px rgba(255,47,90,0.20);
    }
    .cta-primary:hover{
      filter: saturate(1.05);
      box-shadow: 0 12px 28px rgba(255,47,90,0.24);
    }
    
    /* ---------- Footer notes ---------- */
    .foot-notes{ text-align:center; color:var(--txt-dim); display:grid; gap:8px; }
    .guarantee{ margin:0; }
    .secondary-actions{ display:inline-flex; gap:10px; }
    .link-muted{
      color:var(--txt-dim);
      text-decoration:underline; text-underline-offset:3px;
    }
    .link-muted:hover{ color:var(--txt); }
    
    /* ---------- Responsive ---------- */
    @media (max-width:960px){
      .pricing-grid{ grid-template-columns:1fr; max-width:620px; }
      .card{ padding:20px; }
      .price-amount{ font-size:32px; }
    }


    .feature-note,
.features .is-subtle { color: var(--txt-dim); font-size: 0.95em; margin-top: -6px; }


    </style>
    
    <script src="https://js.stripe.com/v3/"></script>

<script>
/* Monthly/Yearly toggle (no framework) */
(function() {
  const toggleBtns = document.querySelectorAll('.toggle-btn');
  const amounts = document.querySelectorAll('.price-amount');

  function setActive(period) {
    toggleBtns.forEach(btn => {
      const active = btn.dataset.billing === period;
      btn.classList.toggle('is-active', active);
      btn.setAttribute('aria-pressed', String(active));
    });
    amounts.forEach(el => {
      el.textContent = el.dataset[period];
    });
  }

  toggleBtns.forEach(btn => {
    btn.addEventListener('click', () => setActive(btn.dataset.billing));
  });

  // default: monthly
  setActive('monthly');
})();
</script>





<script>
    console.log("✅ Stripe checkout script loaded");
    document.addEventListener("DOMContentLoaded", () => {
      const stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}"); // ✅ from Django
    
      document.querySelectorAll(".checkout-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          e.preventDefault();
          const tier = btn.dataset.tier;
    
          try {
            const res = await fetch(`/create-checkout-session/${tier}/`);
            const data = await res.json();
            console.log("Stripe checkout response:", data); // ✅ Debug
    
            if (data.error) {
              alert("Error: " + data.error);
            } 
            // ✅ your backend sends { "url": session.url }
            else if (data.url) {
              window.location.href = data.url; 
            } 
            else if (data.id) {
              // fallback if your backend returns { id: session.id }
              await stripe.redirectToCheckout({ sessionId: data.id });
            }
          } catch (err) {
            console.error("Checkout error:", err);
            alert("Something went wrong. Please try again later.");
          }
        });
      });
    });
    </script>
    


{% endblock %}
