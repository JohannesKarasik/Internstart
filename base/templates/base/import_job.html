<!-- === AI SaaS: Import Job Listings === -->
<div class="ai-shell">
  <div class="bg">
    <span class="orb orb-1"></span>
    <span class="orb orb-2"></span>
    <span class="grid"></span>
  </div>

  <header class="topbar" role="banner">
    <div class="brand">
      <span class="logo-dot" aria-hidden="true"></span>
      <span class="brand-name">Internstart<span class="accent"></span></span>
    </div>
    <nav class="nav" aria-label="primary">
      <a href="#" class="nav-link is-active">Import</a>
      <a href="#" class="nav-link">Jobs</a>
      <a href="#" class="nav-link">Settings</a>
    </nav>
  </header>

  <main class="wrap" role="main">
    <section class="card">
      <header class="card-head">
        <h1 class="title">
          <svg class="title-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M4 4h16v2H4zm0 4h10v2H4zm0 4h16v2H4zm0 4h10v2H4z"/>
          </svg>
          Import Jobs from Scraper
        </h1>
        <p class="subtitle">Run one of your scrapers, view all fetched listings, and process them individually with AI.</p>
      </header>

      <form id="scraperForm" class="form">
        <label class="label">Select Scraper</label>
        <select id="scraperSelect" class="select">
          <option value="uk_marketing">üá¨üáß UK Marketing Scraper</option>
          <!-- Later you can add more like: -->
          <!-- <option value="us_tech">üá∫üá∏ US Tech Scraper</option> -->
        </select>

        <div class="actions" style="margin-top: 16px;">
          <button type="button" id="scrapeBtn" class="btn">Run Scraper</button>
        </div>
      </form>

      <!-- Results -->
      <div id="resultsContainer" class="results-container" style="margin-top: 30px;">
        <p class="muted">No results yet ‚Äî run a scraper to see jobs here.</p>
      </div>
    </section>
  </main>

  <footer class="footer" role="contentinfo">
    <p>Import Jobs <a href="#" class="link">Privacy</a></p>
  </footer>
</div>

<style>
  /* Reuse previous styles */
  :root {
    --accent:#FF2F5A; --bg:#0B0F1A; --bg-2:#0E1324; --card:rgba(18,22,36,.72);
    --stroke:rgba(255,255,255,.08); --text:#E7ECF3; --muted:#A6B0C3;
  }
  body{ margin:0; background:linear-gradient(180deg,var(--bg),var(--bg-2)); color:var(--text); font:500 16px/1.5 Inter, system-ui; }
  .ai-shell{ position:relative; min-height:100dvh; overflow-x:hidden }
  .card{ background:var(--card); border:1px solid var(--stroke); border-radius:16px; padding:28px; }
  .results-container{ display:flex; flex-direction:column; gap:16px; }
  .job-row{
    background:rgba(255,255,255,.04);
    border:1px solid var(--stroke);
    border-radius:14px;
    padding:16px 18px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .job-title{ font-weight:600; font-size:17px; }
  .job-snippet{ font-size:14px; color:var(--muted); }
  .job-link{ font-size:14px; color:var(--accent); text-decoration:none; }
  .job-actions{ display:flex; gap:10px; margin-top:8px; }
  .btn{ background:var(--accent); border:none; border-radius:10px; padding:8px 14px; font-weight:700; cursor:pointer; color:#0B0F1A; }
  .btn.small{ padding:6px 12px; font-size:14px; }
  .btn:hover{ filter:brightness(1.05); }
  .muted{ color:var(--muted); text-align:center; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scrapeBtn = document.getElementById('scrapeBtn');
  const resultsContainer = document.getElementById('resultsContainer');

  scrapeBtn.addEventListener('click', async () => {
    resultsContainer.innerHTML = '<p class="muted">Running scraper... please wait.</p>';

    try {
      // Example endpoint (you‚Äôll build this view in Django):
      const res = await fetch('/run_scraper/?type=uk_marketing');
      const data = await res.json();

      if (!data.results || data.results.length === 0) {
        resultsContainer.innerHTML = '<p class="muted">No jobs found.</p>';
        return;
      }

      resultsContainer.innerHTML = '';
      data.results.forEach((job, i) => {
        const row = document.createElement('div');
        row.className = 'job-row';
        row.innerHTML = `
          <div class="job-title">${job.title || 'Untitled Job'}</div>
          <div class="job-snippet">${job.snippet || ''}</div>
          <a href="${job.link}" target="_blank" class="job-link">${job.link}</a>
          <div class="job-actions">
            <button class="btn small" data-index="${i}">Process & Add to DB with AI</button>
          </div>
        `;
        resultsContainer.appendChild(row);
      });
    } catch (err) {
      resultsContainer.innerHTML = '<p class="muted">‚ùå Error running scraper.</p>';
      console.error(err);
    }
  });

  // Handle "Process with AI" clicks
  document.addEventListener('click', async (e) => {
    if (e.target.matches('.job-actions .btn')) {
      const idx = e.target.dataset.index;
      e.target.textContent = 'Processing...';
      e.target.disabled = true;
      try {
        const res = await fetch(`/process_job_with_ai/?index=${idx}`, { method: 'POST' });
        if (res.ok) e.target.textContent = '‚úÖ Added';
        else throw new Error();
      } catch {
        e.target.textContent = '‚ùå Failed';
      }
    }
  });
});
</script>
