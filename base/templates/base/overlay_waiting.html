{% extends 'main.html' %}
{% load static %}

{% block content %}
<style>
  :root{
    --accent:#FF2F5A;        /* secondary brand color */
    --accent-600:#ff5f7a;
    --bg-0:#ffffff;          /* lots of white */
    --bg-1:#fafafb;
    --text-0:#0f172a;
    --text-1:#475569;
    --muted:#e5e7eb;
  }

  .ai-wait{font-family:'Manrope',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text-0)}
  .ai-wait *{box-sizing:border-box}

  /* ===== Overlay ===== */
  .ai-overlay{
    position:fixed; inset:0; z-index:9999;
    display:grid; place-items:center;
    padding:clamp(16px,3vw,40px);
    background:
      radial-gradient(900px 600px at 85% -10%, rgba(255,47,90,.08), transparent 60%),
      radial-gradient(900px 600px at -10% 100%, rgba(255,47,90,.06), transparent 60%),
      linear-gradient(180deg, var(--bg-0), var(--bg-1));
  }
  /* brand in the corner */
  .ai-brand{
    position:fixed; inset:auto auto 0 0; top:20px; left:24px; z-index:10000;
    display:flex; align-items:center; gap:10px;
  }
  .ai-brand__logo{height:28px; width:auto; border-radius:6px; filter:drop-shadow(0 1px 1px rgba(0,0,0,.05))}
  .ai-brand__name{font-weight:800; color:var(--text-0); font-size:14px; letter-spacing:.2px}

  /* ===== Card ===== */
  .ai-card{
    width:min(920px,94vw);
    border:1px solid rgba(2,6,23,.06);
    background:#fff;
    border-radius:18px;
    box-shadow:0 12px 40px rgba(2,6,23,.06);
    padding:clamp(20px,4vw,36px);
  }
  .ai-grid{display:grid; gap:clamp(18px,3vw,28px); align-items:center}
  @media(min-width:880px){.ai-grid{grid-template-columns:330px 1fr}}

  /* ===== Minimal ‚Äúradar‚Äù animation (simple & smooth) ===== */
  .ai-radar{
    position:relative; width:min(260px,52vw); aspect-ratio:1; margin-inline:auto;
    border-radius:50%;
    background:
      radial-gradient(closest-side, rgba(255,47,90,.10), rgba(255,47,90,0) 62%);
    overflow:hidden;
  }
  /* rotating sweep */
  .ai-radar::after{
    content:""; position:absolute; inset:0; border-radius:50%;
    background:conic-gradient(from 0deg, rgba(255,47,90,.18) 0 20deg, transparent 20deg 360deg);
    animation:sweep 7s linear infinite;
  }
  /* inner dotted ring */
  .ai-radar::before{
    content:""; position:absolute; inset:12%; border-radius:50%;
    border:1.5px dashed rgba(255,47,90,.35);
  }
  /* breathing center dot */
  .ai-dot{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:12px; height:12px; border-radius:50%; background:var(--accent);
    box-shadow:0 0 0 10px rgba(255,47,90,.10);
    animation:breathe 3s ease-in-out infinite;
  }
  @keyframes sweep{to{transform:rotate(360deg)}}
  @keyframes breathe{0%,100%{box-shadow:0 0 0 8px rgba(255,47,90,.10)}50%{box-shadow:0 0 0 14px rgba(255,47,90,.14)}}

  /* ===== Copy ===== */
  .badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px; background:#fff;
    border:1px solid rgba(2,6,23,.06); color:var(--text-1); font-weight:700; margin-bottom:8px;
    box-shadow:0 3px 10px rgba(2,6,23,.06);
  }
  .badge .dot{width:8px; height:8px; border-radius:50%; background:var(--accent)}

  h1{font-weight:800; font-size:clamp(26px,4.4vw,42px); line-height:1.1; letter-spacing:-.02em; margin:0 0 10px}
  h1 .accent{color:var(--accent)}
  p{color:var(--text-1); font-size:clamp(15px,1.6vw,18px); line-height:1.6; margin:0 0 16px}

  /* Status line (simple fade, not sliding) */
  .status{color:var(--text-1); min-height:22px; margin-top:6px}
  .status__text{opacity:1; transition:opacity .28s ease}

  /* Progress */
  .progress{margin-top:12px; height:10px; border-radius:999px; overflow:hidden; background:#f1f5f9; border:1px solid var(--muted)}
  .progress__bar{
    --w:12%; width:var(--w); height:100%;
    background:linear-gradient(90deg, var(--accent), var(--accent-600));
    background-size:200% 100%; animation:shift 2s ease-in-out infinite;
    transition:width .6s cubic-bezier(.22,1,.36,1);
  }
  @keyframes shift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

  /* Steps */
  .steps{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  .step{
    padding:6px 10px; border-radius:8px; background:#fff;
    border:1px solid rgba(2,6,23,.06); color:var(--text-1);
    font-size:12px; font-weight:700; opacity:.7; transition:opacity .2s ease, border-color .2s ease;
  }
  .step.is-active{opacity:1; border-color:rgba(255,47,90,.45); color:var(--text-0)}

  .chip{
    display:inline-flex; align-items:center; gap:10px; margin-top:14px;
    padding:10px 14px; border-radius:10px; background:#fff; border:1px solid rgba(2,6,23,.08);
    font-weight:800; color:var(--text-0); box-shadow:0 4px 12px rgba(2,6,23,.05)
  }
  .chip .c{width:6px; height:6px; border-radius:50%; background:var(--accent)}

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    .ai-radar::after, .ai-dot, .progress__bar{animation:none!important}
  }
</style>

{% if not user.ready %}
<div class="ai-wait">
  <div class="ai-overlay" role="status" aria-live="polite">
    <!-- Brand -->
    <div class="ai-brand">
      <img class="ai-brand__logo" src="{% static 'images/Internstartlogo (1).jpg' %}" alt="Internstart logo">
      <!-- Optional: show name if you want -->
      <!-- <span class="ai-brand__name">Internstart</span> -->
    </div>

    <!-- Card -->
    <section class="ai-card">
      <div class="ai-grid">
        <!-- Left: Minimal radar -->
        <div class="ai-radar" aria-hidden="true">
          <span class="ai-dot"></span>
        </div>

        <!-- Right: Copy -->
        <div>
          <div class="badge"><span class="dot"></span> AI matching in progress</div>
          <h1>
            Gathering <span class="accent">{{ user.desired_job_title|default:"new"|lower }}</span> roles tailored to your resume
          </h1>
          <p>We‚Äôre scanning fresh openings, ranking them by fit, and preparing one-click applications. This can take a while depending on volume.</p>

          <div class="status">
            <span id="statusText" class="status__text">üîé Crawling sources & company boards</span>
          </div>

          <div class="progress" aria-label="Loading progress">
            <div class="progress__bar" id="aiProgressBar"></div>
          </div>

          <div class="steps" id="aiSteps">
            <span class="step is-active">Crawl</span>
            <span class="step">Match</span>
            <span class="step">Rank</span>
            <span class="step">Prepare</span>
          </div>

          <div class="chip" aria-disabled="true">
            <span class="c" aria-hidden="true"></span> You‚Äôll be notified when it‚Äôs ready
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
  // Simple, smooth progress + status rotation (kept minimal)
  (function(){
    const bar = document.getElementById('aiProgressBar');
    const steps = Array.from(document.getElementById('aiSteps').children);
    const statusEl = document.getElementById('statusText');

    let pct = 10;
    let stepIndex = 0;
    const statuses = [
      'üîé Crawling sources & company boards',
      'üß† Matching your experience',
      '‚öñÔ∏è Ranking by relevance & signals',
      'üì¨ Preparing one-click apply actions'
    ];

    function updateProgress(){
      const next = Math.min(90, pct + Math.random()*5 + 1.5);
      pct = next;
      bar.style.setProperty('--w', next.toFixed(1) + '%');

      const thresholds = [0, 28, 56, 80];
      const idx = thresholds.filter(t => pct >= t).length - 1;
      if(idx !== stepIndex){
        steps.forEach((s,i)=>s.classList.toggle('is-active', i===idx));
        stepIndex = idx;
      }
    }

    function rotateStatus(){
      statusEl.style.opacity = 0;
      setTimeout(()=>{
        const i = (stepIndex) % statuses.length;
        statusEl.textContent = statuses[i];
        statusEl.style.opacity = 1;
      }, 220);
    }

    const progTimer = setInterval(updateProgress, 1400);
    const statTimer = setInterval(rotateStatus, 1800);

    // Clean up if the page changes away naturally
    setTimeout(()=>{ clearInterval(progTimer); clearInterval(statTimer); }, 180000);
  })();
</script>

{% else %}
  {% include 'base/swipe_page.html' %}
{% endif %}
{% endblock %}
