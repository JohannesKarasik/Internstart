{% extends 'main.html' %}
{% load static %}

{% block content %}
<style>
  :root{
    --accent:#FF2F5A;
    --accent-600:#ff5f7a;
    --bg-0:#ffffff;
    --bg-1:#fafafb;
    --text-0:#0f172a;
    --text-1:#475569;
    --muted:#e5e7eb;
  }

  /* ===== subtle animated background blobs (faster) ===== */
  body{
    background:#ffffff;
    overflow-x:hidden;
  }
  body::before,
  body::after{
    content:"";
    position:fixed;
    top:-220px;
    width:620px; height:620px;
    border-radius:50%;
    filter:blur(180px);
    opacity:.25;
    z-index:-1;
    will-change: transform, opacity;
  }
  /* Left blob */
  body::before{
    left:-220px;
    background:#FF2F5A55;
    animation:blobLeft 12s ease-in-out infinite alternate;
  }
  /* Right blob */
  body::after{
    right:-220px;
    background:#ff5f7a55;
    animation:blobRight 13s ease-in-out infinite alternate;
  }

  @keyframes blobLeft{
    0%   { transform: translate(-8%, 0) rotate(0deg) scale(1);     opacity:.22; }
    50%  { transform: translate(6%, 70px) rotate(10deg) scale(1.05); opacity:.28; }
    100% { transform: translate(14%, 140px) rotate(22deg) scale(1.1); opacity:.24; }
  }
  @keyframes blobRight{
    0%   { transform: translate(8%, 0) rotate(0deg) scale(1.02);    opacity:.22; }
    50%  { transform: translate(-6%, 80px) rotate(-10deg) scale(1.08); opacity:.29; }
    100% { transform: translate(-14%, 150px) rotate(-22deg) scale(1.12); opacity:.25; }
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    body::before, body::after{ animation: none !important; }
  }

  .ai-wait{font-family:'Manrope',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text-0)}
  .ai-wait *{box-sizing:border-box}

  /* ===== Foreground overlay area (transparent to reveal blobs) ===== */
  .ai-overlay{
    position:fixed;
    top:140px;  /* leaves room for ticker + header */
    left:0;
    right:0;
    bottom:0;
    display:grid; place-items:center;
    padding:clamp(16px,3vw,40px);
    background:transparent;
    pointer-events:none; /* let clicks pass through wrapper */
  }

  /* ===== Card ===== */
  .ai-card{
    width:min(980px,94vw);
    background:#fff;
    border:1px solid rgba(2,6,23,.06);
    border-radius:18px;
    box-shadow:0 14px 44px rgba(2,6,23,.06);
    padding: clamp(20px, 4vw, 36px);
    pointer-events:auto; /* re-enable interactions on the card */
  }

  .ai-header{
    display:flex; align-items:center; justify-content:space-between;
    gap:16px; margin-bottom:10px;
  }
  .ai-logo{
    display:flex; align-items:center; gap:10px;
  }
  .ai-logo img{height:28px; width:auto; border-radius:6px}

  .badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px; background:#fff;
    border:1px solid rgba(2,6,23,.06); color:var(--text-1); font-weight:700;
    box-shadow:0 3px 10px rgba(2,6,23,.06);
    white-space:nowrap;
  }
  .badge .dot{width:8px; height:8px; border-radius:50%; background:var(--accent)}

  .ai-grid{display:grid; gap:clamp(18px,3vw,28px); align-items:center}
  @media(min-width:900px){.ai-grid{grid-template-columns:320px 1fr}}

  /* ===== Left illustration ripples ===== */
  .ai-ripples{
    position:relative; width:min(240px,52vw); aspect-ratio:1;
    margin-inline:auto; border-radius:50%;
    background: radial-gradient(closest-side, rgba(255,47,90,.08), transparent 60%);
  }
  .ai-ripples .ring{
    position:absolute; left:50%; top:50%; translate:-50% -50%;
    width:38%; aspect-ratio:1; border-radius:50%;
    border:2px solid rgba(255,47,90,.30);
    opacity:0; transform:scale(.45);
    animation:ripple 2.0s ease-out infinite;
  }
  .ai-ripples .r2{animation-delay:.5s}
  .ai-ripples .r3{animation-delay:1.0s}

  .ai-ripples .core{
    position:absolute; left:50%; top:50%; translate:-50% -50%;
    width:14px; height:14px; border-radius:50%; background:var(--accent);
    box-shadow:0 0 0 10px rgba(255,47,90,.10);
    animation:pulse 2.2s ease-in-out infinite;
  }

  @keyframes ripple{
    0%   {opacity:.65; transform:scale(.35)}
    70%  {opacity:.12}
    100% {opacity:0; transform:scale(1)}
  }
  @keyframes pulse{
    0%,100%{box-shadow:0 0 0 8px rgba(255,47,90,.10)}
    50%    {box-shadow:0 0 0 14px rgba(255,47,90,.16)}
  }

  /* ===== Copy ===== */
  h1{font-weight:800; font-size:clamp(26px,4.4vw,42px); line-height:1.1; letter-spacing:-.02em; margin:6px 0 10px}
  h1 .accent{color:var(--accent)}
  p{color:var(--text-1); font-size:clamp(15px,1.6vw,18px); line-height:1.6; margin:0 0 16px}

  .status{color:var(--text-1); min-height:22px; margin-top:6px}
  .status__text{opacity:1; transition:opacity .25s ease}

  .progress{margin-top:12px; height:10px; border-radius:999px; overflow:hidden; background:#f1f5f9; border:1px solid var(--muted)}
  .progress__bar{
    --w:12%; width:var(--w); height:100%;
    background:linear-gradient(90deg, var(--accent), var(--accent-600));
    background-size:200% 100%; animation:shift 2s ease-in-out infinite;
    transition:width .6s cubic-bezier(.22,1,.36,1);
  }
  @keyframes shift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

  .steps{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  .step{
    padding:6px 10px; border-radius:8px; background:#fff;
    border:1px solid rgba(2,6,23,.06); color:var(--text-1);
    font-size:12px; font-weight:700; opacity:.7; transition:opacity .2s ease, border-color .2s ease;
  }
  .step.is-active{opacity:1; border-color:rgba(255,47,90,.45); color:var(--text-0)}

  .chip{
    display:inline-flex; align-items:center; gap:10px; margin-top:14px;
    padding:10px 14px; border-radius:10px; background:#fff; border:1px solid rgba(2,6,23,.08);
    font-weight:800; color:var(--text-0); box-shadow:0 4px 12px rgba(2,6,23,.05)
  }
  .chip .c{width:6px; height:6px; border-radius:50%; background:var(--accent)}

  @media (prefers-reduced-motion: reduce){
    .ai-ripples .ring, .ai-ripples .core, .progress__bar{animation:none!important}
  }
</style>

{% if not user.ready %}
<div class="ai-wait">
  <div class="ai-overlay" role="status" aria-live="polite">
    <section class="ai-card">
      <header class="ai-header">
        <div class="ai-logo">
          <img src="{% static 'images/Internstartlogo (1).jpg' %}" alt="Internstart logo">
        </div>
        <div class="badge"><span class="dot"></span> AI matching in progress</div>
      </header>

      <div class="ai-grid">
        <div class="ai-ripples" aria-hidden="true">
          <span class="ring r1"></span>
          <span class="ring r2"></span>
          <span class="ring r3"></span>
          <span class="core"></span>
        </div>
        <div>
          <h1>Gathering <span class="accent">{{ user.desired_job_title|default:"new"|lower }}</span> roles tailored to your resume</h1>
          <p>Weâ€™re scanning fresh openings, ranking them by fit, and preparing one-click applications. This can take a while depending on volume.</p>

          <div class="status">
            <span id="statusText" class="status__text">ðŸ”Ž Crawling sources & company boards</span>
          </div>

          <div class="progress" aria-label="Loading progress">
            <div class="progress__bar" id="aiProgressBar"></div>
          </div>

          <div class="steps" id="aiSteps">
            <span class="step is-active">Crawl</span>
            <span class="step">Match</span>
            <span class="step">Rank</span>
            <span class="step">Prepare</span>
          </div>

          <div class="chip" aria-disabled="true">
            <span class="c" aria-hidden="true"></span> Youâ€™ll be notified when itâ€™s ready
          </div>
        </div>
      </div>
    </section>

  </div>
</div>

<script>
  (function(){
    const bar = document.getElementById('aiProgressBar');
    const steps = Array.from(document.getElementById('aiSteps').children);
    const statusEl = document.getElementById('statusText');

    let pct = 12;
    let stepIndex = 0;
    const statuses = [
      'ðŸ”Ž Crawling sources & company boards',
      'ðŸ§  Matching your experience',
      'âš–ï¸ Ranking by relevance & signals',
      'ðŸ“¬ Preparing one-click apply actions'
    ];

    function updateProgress(){
      const next = Math.min(92, pct + Math.random()*5 + 1.2);
      pct = next;
      bar.style.setProperty('--w', next.toFixed(1) + '%');

      const thresholds = [0, 28, 56, 80];
      const idx = thresholds.filter(t => pct >= t).length - 1;
      if (idx !== stepIndex){
        steps.forEach((s,i)=>s.classList.toggle('is-active', i===idx));
        stepIndex = idx;
      }
    }

    function rotateStatus(){
      statusEl.style.opacity = 0;
      setTimeout(()=>{
        statusEl.textContent = statuses[stepIndex % statuses.length];
        statusEl.style.opacity = 1;
      }, 200);
    }

    const progTimer = setInterval(updateProgress, 1400);
    const statTimer = setInterval(rotateStatus, 1800);
    setTimeout(()=>{ clearInterval(progTimer); clearInterval(statTimer); }, 180000);
  })();
</script>

{% else %}
  {% include 'base/swipe_page.html' %}
{% endif %}
{% endblock %}
